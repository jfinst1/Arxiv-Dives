# OLMOTRACE Simulator

A monolithic Python application for tracing language model outputs against a corpus. Built with Flask, SQLite, and advanced NLP tools like DistilBERT and BM25, it supports span/token tracing, corpus search, document visualization, and export options (CSV/PDF).

## Features

- **Span/Token Tracing**: Identify and merge maximal spans or tokens from LM output present in the corpus.
- **Corpus Search**: Query the corpus with BM25 ranking.
- **Document Visualization**: Highlight matches in full documents with `<mark>` tags.
- **Export Options**: Download results as CSV or PDF.
- **Fine-Tuned DistilBERT**: Relevance scoring (0-3 scale) using a small synthetic dataset.
- **Web Interface**: Interactive UI with drag-and-drop corpus upload.

## Prerequisites

- Python 3.8+
- Required packages:

```bash
flask transformers rank_bm25 suffix_trees nltk torch beautifulsoup4 bleach reportlab datasets
```

## Installation

Clone or download this repository:

```bash
git clone https://github.com/yourusername/olmotrace.git
cd olmotrace
```

Install dependencies:

```bash
pip install -r requirements.txt
```

Or directly:

```bash
pip install flask transformers rank_bm25 suffix_trees nltk torch beautifulsoup4 bleach reportlab datasets
```

(Optional) Prepare a corpus file (e.g., `corpus.txt`):

```text
The Space Needle was built for the 1962 World Fair in Seattle.
I'm going on an adventure to explore new lands.
```

## Usage

Run the application:

```bash
python olmotrace.py
```

With a custom corpus and port:

```bash
python olmotrace.py --corpus-file corpus.txt --db-path my_corpus.db --port 5001
```

Open your browser to [http://localhost:5000](http://localhost:5000) (or the specified port).

### Trace LM Output:

- **User Prompt**: "Tell me about the Space Needle."
- **LM Output**: "The Space Needle was built for the 1962 World Fair."
- Adjust "Max Documents" and "Snippet Length" as needed.
- Check "Trace Individual Tokens" for token-level analysis.
- Click "Trace" to see highlighted spans/tokens and matching documents.

### Search Corpus:

- Enter a query (e.g., "Space Needle") and set "Max Results."
- Click "Search" to view ranked documents.

### Upload Corpus:

- Drag and drop a `.txt` file into the dropzone or click to upload.

### Export Results:

- After tracing, use "Export as CSV" or "Export as PDF" buttons.

## Example Output

**Input:**

- **Prompt**: "Tell me about the Space Needle."
- **LM Output**: "The Space Needle was built for the 1962 World Fair, and I'm going on an adventure."

**Output:**

- **Highlighted Spans**: `<span class="span-highlight">The Space Needle was built for the 1962 World Fair</span>`, and `<span class="span-highlight">I'm going on an adventure</span>`

**Documents:**

- **Span**: "The Space Needle was built for the 1962 World Fair"
  - Doc 0: "the space needle was built for the 1962 world fair in seattle" (BM25: 7.12, Relevance: High (3))
- **Span**: "I'm going on an adventure"
  - Doc 1: "i 'm going on an adventure to explore new lands" (BM25: 6.33, Relevance: High (3))

## Code

The full source code is available in this repository. It includes:

- **EnhancedOLMOTRACE Class**: Core tracing logic with SQLite backend.
- **Flask Routes**: Web interface endpoints (`/trace`, `/search`, `/upload_corpus`, `/export_csv`, `/export_pdf`).
- **HTML Template**: Embedded UI with JavaScript for interactivity.

To use, save `olmotrace.py` alongside this README and ensure the `templates/` directory is created with `index.html` (auto-generated by the script).

## License

This project is licensed under my craziness. See the `LICENSE` file for details.
